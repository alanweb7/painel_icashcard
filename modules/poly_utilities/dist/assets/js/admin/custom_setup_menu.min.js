(()=>{function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a,n,o,l,r,i,u,s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){r=[],i=!0,u=!1;try{if(o=(s=s.call(e)).next,0===t){if(Object(s)!==s)return;i=!1}else for(;!(i=(a=o.call(s)).done)&&(r.push(a.value),r.length!==t);i=!0);}catch(e){u=!0,n=e}finally{try{if(!i&&null!=s.return&&(l=s.return(),Object(l)!==l))return}finally{if(u)throw n}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}window.addEventListener("load",(function(){!function(e){"use strict";var t=Vue,a=t.createApp,n=t.ref,o=t.watch,l=t.onMounted,r=t.nextTick,i=a({setup:function setup(){function initDataDefault(){S.value={name:"",parent_slug:"root",target:"_self",rel:"nofollow",type:"default",badge:{color:"",value:""}}}function definedWatchLoad(){H=e(".poly-colorpicker-input-value"),O=e(".select2.roles"),D=e(".select2.users")}function updateColorPicker(){var e,t="",a=(null==S||null===(e=S.value)||void 0===e||null===(e=e.badge)||void 0===e?void 0:e.color)||t;H.val(a)}function fetchData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Promise.all([fetchDefaultSettings(),fetchMenuItems(),fetchCustomMenuItems(),fetchRoles()]).then((function(e){var t=_slicedToArray(e,4),a=t[0],n=t[1],o=t[2],l=t[3];C.value=_toConsumableArray(n),o.forEach((function(e){try{e.aroles=e.roles?JSON.parse(e.roles):[]}catch(t){e.aroles=[]}try{e.ausers=e.users?JSON.parse(e.users):[]}catch(t){e.ausers=[]}})),T.value=o,x.value=a,A.value=l,I.value=!0})).catch((function(e){}))}function fetchDefaultSettings(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_default_settings"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function fetchMenuItems(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_setup_menu_items"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function fetchRoles(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_roles"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function updateMenuOptions(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=e("body").find("#poly-active-menu .list-group-item").not(".list-group-item.sub"),n=!1,o=[];e.each(a,(function(t,a){var l,r,i,u,s,c,d,f,p=e(this);!1===n?n=t+1:n+=1,r={},i=p.data("parent_slug"),r.name=p.data("name"),u=p.data("is_custom"),r.is_custom=null!=u&&u,r.id=p.data("id"),r.slug=p.data("slug"),r.type=p.data("type"),r.css=p.data("css"),s=p.attr("data-disabled"),r.disabled="true"===s,r.roles=JSON.stringify(p.data("roles")),r.users=JSON.stringify(p.data("users")),r.href=null!==(l=p.data("href_original"))&&void 0!==l?l:p.data("href"),r.target=p.data("target"),r.rel=p.data("rel"),r.parent_slug=null!=i?i:"root",r.icon=p.data("icon"),r.badge=p.data("badge"),r.position=n,c=p.find(".list-group-item.sub"),d=!1,f=[],e.each(c,(function(t,a){var n,o,l,r,i;!1===d?d=t+1:d+=1,void 0!==(n=e(this)).data("id")&&((l={}).id=n.data("id"),l.name=n.data("name"),r=n.data("is_custom"),l.is_custom=null!=r&&r,l.slug=n.data("slug"),l.type=n.data("type"),l.css=n.data("css"),i=n.attr("data-disabled"),l.disabled="true"===i,l.roles=JSON.stringify(n.data("roles")),l.users=JSON.stringify(n.data("users")),l.href=null!==(o=n.data("href_original"))&&void 0!==o?o:n.data("href"),l.target=n.data("target"),l.rel=n.data("rel"),l.parent_slug=n.data("parent_slug"),l.icon=n.data("icon"),l.badge=n.data("badge"),l.position=d,f.push(l))})),r.children=f,o.push(r)})),e.post(admin_url+"poly_utilities/update_setup_menu_positions",{data:o}).done((function(e){var a=e;t||window.location.reload(),PolyMessage.displayNotification(a.status,a.message)}))}function fetchCustomMenuItems(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_custom_setup_menu_items"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function handleStaffInfo(e){window.open("".concat(admin_url,"staff/member/").concat(e.id),"_blank")}function handleRoleInfo(e){window.open("".concat(admin_url,"roles/role/").concat(e.id),"_blank")}function isEdit(e){P.value=e}function validationForm(e,t){var a,n=Object.fromEntries(e.entries()),o=!0;return n.name.trim()?t.value.name=null:(t.value.name="Title cannot be empty.",o=!1),a=["default"],!n.href.trim()&&a.includes(S.value.type)?(t.value.href="Href cannot be empty.",o=!1):t.value.href=null,o}var t,a,i,u,s,c,d,f,p,m,v,y,h,_,g,b,w,x=n([]),C=n([]),S=n({}),T=n([]),A=n([]),I=n(!1),M=n(!1),P=n(!1),k=n([]),j=n([]),O=null,D=null,H=null,E=n({});return initDataDefault(),o([C,T,A,S],(function(){r().then((function(){definedWatchLoad(),t(),appColorPicker(),updateColorPicker(),PolyOperationFunctions.Icons(e(".poly-utilities-aio-icon-select")),O.length>0&&(O.select2({placeholder:"Select an option",width:"resolve"}),O.on("change",(function(e){var t=O.select2("data"),a=t.map((function(e){return{id:e.id,text:e.text}}));j.value=a}))),D.length>0&&(D.select2({placeholder:"Select users",width:"resolve",delay:250,minimumInputLength:2,ajax:{url:"".concat(admin_url,"poly_utilities/ajax_users_search"),dataType:"json",data:function data(e){var t;return{search:e.term,type:"public"}},processResults:function processResults(e){var t;return{results:e.map((function(e){return{id:e.staffid,text:"".concat(e.lastname," ").concat(e.firstname),avatar:e.avatar}}))}}},templateResult:function templateResult(t){return t.id?e('<div class="poly-utilities-user-search-result"><img src="'.concat(t.avatar,'" class="avatar-user"/> ').concat(t.text,"</div>")):t.text;var a},templateSelection:function templateSelection(t){var a,n,o,l;return t.id?(n="",t.element&&(o=e(t.element).data("avatar"))&&(n=o),n=null!==(a=t.avatar)&&void 0!==a?a:n,l=e('<span class="poly-utilities-user-search-result"><img src="'.concat(n,'" class="avatar-user"/> ').concat(t.text,"</span>"))):t.text},escapeMarkup:function escapeMarkup(e){return e}}),D.on("change",(function(t){var a=D.select2("data"),n=a.map((function(t){return{id:t.id,text:t.text,avatar:e(t.element).data("avatar")||t.avatar}}));k.value=n})))}))})),l((function(){fetchData(),e(document).on("click",".list-group.nested-sortable",(function(t){var a,n,o,l;t.preventDefault(),t.stopPropagation(),o=(n=(a=e(t.target)).closest("div")).find(".toggle-widgets i"),(l=n.find(".list-group.nested-sortable").first()).length&&(l.slideToggle(),o.hasClass("fa-caret-up")?o.removeClass("fa-caret-up").addClass("fa-caret-down"):o.removeClass("fa-caret-down").addClass("fa-caret-up"))}))})),t=function setupSortable(){var e,t=[].slice.call(document.querySelectorAll(".poly-menu .nested-sortable"));for(e=0;e<t.length;e++)new Sortable(t[e],{group:"poly-menu",animation:150,fallbackOnBody:!0,swapThreshold:.65,onStart:function onStart(e){},onAdd:function onAdd(e){var t,a=e.item,n=a.parentNode;n.classList.contains("list-group")&&(null!==(t=n.parentNode.getAttribute("data-slug"))?(a.classList.add("sub"),a.setAttribute("data-parent_slug",t)):(a.setAttribute("data-parent_slug","root"),a.classList.remove("sub")))},onEnd:function onEnd(e){updateMenuOptions()}})},a=function handleSubmit(t){var a,n;if(M.value=!0,a=e("#poly_utilities_add_custom_sidebar_form").get(0),!validationForm(n=new FormData(a),E))return M.value=!1,!1;n.set("users",JSON.stringify(k.value)),n.set("roles",JSON.stringify(j.value)),n.append("is_edit",P.value),n.append("is_custom","true"),!0===P.value&&(n.append("id",S.value.id),n.append("slug",S.value.slug),n.append("position",S.value.position)),fetch(a.action,{method:"POST",body:n}).then((function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(e){P.value?(window.location.reload(),PolyMessage.displayNotification("".concat(e.status),"".concat(e.message))):window.location.reload()})).catch((function(e){})).finally((function(){M.value=!1}))},i=function initDefaultValue(e){var t,a,n,o,l,r,i,u,s;e.type=null!==(t=e.type)&&void 0!==t?t:"default",e.target=null!==(a=e.target)&&void 0!==a?a:"_self",e.rel=null!==(n=e.rel)&&void 0!==n?n:"follow",e.parent_slug=null!==(o=null==e?void 0:e.parent_slug)&&void 0!==o?o:"root",e.href=null!==(l=null==e?void 0:e.href_original)&&void 0!==l?l:e.href,s=null!==(r=null==e?void 0:e.position)&&void 0!==r?r:0,s=parseInt(s),e.position=s,e.badge||(e.badge={}),e.badge.value=null!==(i=e.badge.value)&&void 0!==i?i:"",e.badge.color=null!==(u=e.badge.color)&&void 0!==u?u:""},u=function handleClone(t){var a,n,o,l,r=t.id+"_cloned";t.id=r,t.slug=r,t.is_custom=!0,i(t),t.name=PolyCommon.extractTextFromHtml(t.name),t.badge={color:null!==(a=null==t||null===(n=t.badge)||void 0===n?void 0:n.color)&&void 0!==a?a:"",value:null!==(o=null==t||null===(l=t.badge)||void 0===l?void 0:l.value)&&void 0!==o?o:""},e.post(admin_url+"poly_utilities/clone_setup_menu",{data:t}).done((function(e){var t=e;PolyMessage.displayNotification(t.status,t.message),fetchData()}))},s=function decodeHtml(e){return PolyCustomMenu.decodeHtml(e)},c=function handleIcon(e){var t=PolyCustomMenu.decodeHtml(e.icon);return t.includes("<svg")?t:'<i class="'.concat(e.icon,'">&nbsp;</i>')},d=function handleEdit(t){var a,n,o,l,r,u,s,c;PolyOperationFunctions.Scrolling(),P.value=!0,"iframe"===t.type&&t.href_original&&(t.href=t.href_original),t.roles=null!==(a=null==t?void 0:t.roles)&&void 0!==a?a:"[]",t.users=null!==(n=null==t?void 0:t.users)&&void 0!==n?n:"[]",i(t),S.value=t,null!=t&&t.icon&&(o=PolyCustomMenu.decodeHtml(t.icon)).includes("<svg")&&(S.value.svg=t.icon,S.value.icon=""),S.value.name=PolyCommon.extractTextFromHtml(S.value.name),r=(l=JSON.parse(t.roles)).map((function(e){return{id:e.id,text:e.text}})),j.value=r,u=r.map((function(e){return e.id})),O.val(u).trigger("change"),c=(s=JSON.parse(t.users)).map((function(e){return{id:e.id,text:e.text,avatar:e.avatar}})),k.value=c,D.empty(),c.forEach((function(t){var a=new Option(t.text,t.id,!0,!0);e(a).data("avatar",t.avatar),D.append(a)})),updateColorPicker()},f=PolyComponents.useFilteredTypes(S,x),{default_settings:x,dataLoaded:I,isProccessing:M,validation_fields:E,menu_items:C,custom_menu_items:T,roles:A,item_edit_object:S,is_edit:P,isEdit,handleEdit:d,decodeHtml:s,handleIcon:c,handleClone:u,handleDisabled:h=function handleDisabled(t,a){var n,o;t.preventDefault(),(n=e(t.target).closest(".onoffswitch").find('input[type="checkbox"]')).length&&(o=!n.prop("checked"),n.prop("checked",o),a.disabled=o,r().then((function(){updateMenuOptions(!0)})))},handleDelete:m=function handleDelete(t){var a={};a.id=t.slug,Swal.fire({title:poly_utilities_settings.popup_delete.header,text:poly_utilities_settings.popup_delete.message,showCancelButton:!0,confirmButtonColor:poly_utilities_settings.popup_delete.confirm_color,cancelButtonColor:poly_utilities_settings.popup_delete.cancel_color,cancelButtonText:poly_utilities_settings.popup_delete.cancel,confirmButtonText:poly_utilities_settings.popup_delete.confirm,allowOutsideClick:!1}).then((function(t){t.isConfirmed&&e.post(admin_url+"poly_utilities/delete_custom_setup_menu",a).done((function(e){window.location.reload()}))}))},handleSubmit:a,handleStaffInfo,handleRoleInfo,handleReactivationModule:y=function handleReactivationModule(){PolyCustomMenu.handleReactivationModule()},handleDividerStyles:_=function handleDividerStyles(e){return PolyCustomMenu.HandleDividerStyles(e)},handleHtmlContent:g=function handleHtmlContent(e){return PolyCustomMenu.HandleHtmlContent(e)},extractTextFromHtml:b=function extractTextFromHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},handleResetCustomMenu:v=function handleResetCustomMenu(e){PolyCustomMenu.HandleResetCustomMenu(e)},handleChangeLinkType:p=function handleChangeLinkType(t){var a,n;"divider"===t.type&&(a="fa-solid fa-grip-lines fa-fw",e("#name").val("Divider"),e("#badge\\[value\\]").val("2px"),e("#badge\\[color\\]").val("transparent"),e('textarea[name="icon"]').val(a),(n=e("#poly_field_aio_supports_button i")).length>0&&(n.removeClass(),n.addClass(a)))},filteredTypes:f,removeIcon:w=function removeIcon(e){null!=e&&e.icon&&(e.icon=""),null!=e&&e.svg&&(e.svg="")}}}}).mount("#polyApp")}(jQuery)}))})();