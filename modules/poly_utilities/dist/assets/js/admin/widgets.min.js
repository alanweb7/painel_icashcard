!function(t){"use strict";function toggle_widget_poly_utitlities(e){var i,a,l,o,n;e.preventDefault(),l=(a=(i=t(e.target)).closest("li")).data("id"),o=a.find(".toggle-widgets i"),(n=a.find('.widget-item-block[widget-target="'+l+'"]'))&&(n.slideToggle(),o.hasClass("fa-caret-up")?o.removeClass("fa-caret-up").addClass("fa-caret-down"):o.removeClass("fa-caret-down").addClass("fa-caret-up"))}function update_widgets_poly_utitlities(){var e,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!=a&&a.preventDefault(),e=t(".poly-widgets-area").get(),i=[],e.forEach((function(e){var a=t(e).find(".block"),l=a.attr("id"),o=a.attr("default"),n=a.find(".poly-widget-list.active li").get(),s=[];n.forEach((function(e){var i=t(e),a=i.data("id"),l=i.data("type"),o=i.find(".item-property").get(),n=i.find(".item-roles-property").get(),d=[],c=[],r={};r.id=a,r.type=l,r.name=i.data("name"),o.forEach((function(e){var i=t(e),a=i.attr("type"),o="";switch(a){case"text":i.val(PolyCommon.PurseContent(i.val())),o=i.val();break;case"checkbox":o=i.prop("checked");break;case"textarea":"text"===l&&i.val(PolyCommon.PurseContent(i.val())),"html"===l&&i.val(PolyCommon.PurseScripts(i.val())),o=i.val();break;default:o=i.val()}d.push({name:i.attr("field"),type:a,label:i.attr("label"),value:o})})),r.fields=d,n.forEach((function(e){var i=t(e),a=i.attr("type"),l="";l=i.prop("checked"),c.push({name:i.attr("field"),type:a,label:i.attr("label"),value:l})})),r.roles=c,s.push(r)})),i.push({id:l,default:o,widgets:s})})),t.post(admin_url+"poly_utilities/update_widget",{data:i}).done((function(t){var e=t;PolyMessage.displayNotification(e.status,e.message)}))}t(document).on("click",".item-roles-label",(function(e){var i,a=t(e.target),l=a.find("input");0!=l.length&&(i=PolyCommon.generateUniqueID(),l.attr("id",i),a.attr("for",i))})),t(document).on("click",".poly-widgets-submit",(function(t){update_widgets_poly_utitlities(t)})),t(document).on("click",".poly-widget-list.active .item-roles-property",(function(e){var i;e.stopPropagation(),t(e.target).is(":checkbox")&&update_widgets_poly_utitlities()})),t(document).on("click",".poly-widget-list.active .widget-delete",(function(e){e.preventDefault(),e.stopPropagation(),Swal.fire({title:poly_utilities_settings.popup_delete.header,text:poly_utilities_settings.popup_delete.message,showCancelButton:!0,confirmButtonColor:poly_utilities_settings.popup_delete.confirm_color,cancelButtonColor:poly_utilities_settings.popup_delete.cancel_color,cancelButtonText:poly_utilities_settings.popup_delete.cancel,confirmButtonText:poly_utilities_settings.popup_delete.confirm,allowOutsideClick:!1}).then((function(i){var a,l;i.isConfirmed&&((l=(a=t(e.target)).closest("li")).remove(),update_widgets_poly_utitlities(e))}))})),t(document).on("click",".poly-widget-list.active .widget-clone",(function(e){var i,a,l;e.preventDefault(),e.stopPropagation(),l=(a=(i=t(e.target)).closest("li")).clone(),a.after(l),update_widgets_poly_utitlities(e)})),t(document).on("click",".poly-widgets-area .block .widget",(function(e){var i,a,l,o,n;e.preventDefault(),void 0!==(l=(a=(i=t(e.target)).closest("li")).data("block-id"))&&(o=a.find(".toggle-widgets i"),(n=a.find('.widget-block[block-target="'+l+'"]'))&&(n.slideToggle(),o.hasClass("fa-caret-up")?o.removeClass("fa-caret-up").addClass("fa-caret-down"):o.removeClass("fa-caret-down").addClass("fa-caret-up")))})),t(document).on("click",".poly-widget-list.active .widget-close",(function(t){toggle_widget_poly_utitlities(t),update_widgets_poly_utitlities(t)})),t(document).on("click",".poly-widget-list.active .widget",(function(t){toggle_widget_poly_utitlities(t)})),t("#poly-widget-list, #poly-widget-list-active").sortable({connectWith:".poly-widget-list",placeholder:"ui-state-highlight",start:function start(t,e){var i;"poly-widget-list"===e.item.parent().attr("id")&&e.item.data("fixed",!0)},update:function update(e,i){var a;"poly-widget-list"===i.item.parent().attr("id")&&t(this).sortable("cancel")},stop:function stop(e,i){var a,l,o=i.item.parent();"poly-widget-list"===o.attr("id")?t(this).sortable("cancel"):i.item.data("fixed")&&(a="w".concat(PolyCommon.generateUniqueID()),i.item.attr("data-id",a),i.item.find(".widget-item-block").attr("widget-target",a),l=i.item.clone().removeClass("ui-state-highlight"),t("#left-column ul").append(l),l.html(l.html()),i.item.data("fixed",!1)),update_widgets_poly_utitlities()}}).disableSelection()}(jQuery);