(()=>{function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=Array(e);a<e;a++)r[a]=t[a];return r}function _iterableToArrayLimit(t,e){var a,r,n,u,s,i,o,c=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=c){s=[],i=!0,o=!1;try{if(n=(c=c.call(t)).next,0===e){if(Object(c)!==c)return;i=!1}else for(;!(i=(a=n.call(c)).done)&&(s.push(a.value),s.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{if(!i&&null!=c.return&&(u=c.return(),Object(u)!==u))return}finally{if(o)throw r}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}window.addEventListener("load",(function(){!function(t){"use strict";var e=Vue,a=e.createApp,r=e.ref,n=e.watch,u=e.onMounted,s=e.nextTick,i=a({setup:function setup(){function definedWatchLoad(){c=t("#users"),l=t("#users_custom_menu"),c&&configureSelect2(c,"Select users"),l&&configureSelect2(l,"Select users for custom menu"),c.on("change",(function(e){var a=c.select2("data"),r=a.map((function(e){return{id:e.id,text:e.text,avatar:t(e.element).data("avatar")||e.avatar}}));i.value=r})),l.on("change",(function(e){var a=l.select2("data"),r=a.map((function(e){return{id:e.id,text:e.text,avatar:t(e.element).data("avatar")||e.avatar}}));o.value=r}))}function configureSelect2(e,a){e.select2({placeholder:a,width:"resolve",delay:250,minimumInputLength:2,ajax:{url:"".concat(admin_url,"poly_utilities/ajax_users_search"),dataType:"json",data:function data(t){var e;return{search:t.term,type:"public"}},processResults:function processResults(t){var e;return{results:t.map((function(t){return{id:t.staffid,text:"".concat(t.lastname," ").concat(t.firstname),avatar:t.avatar}}))}}},templateResult:function templateResult(e){return e.id?t('<div class="poly-utilities-user-search-result"><img src="'.concat(e.avatar,'" class="avatar-user"/> ').concat(e.text,"</div>")):e.text;var a},templateSelection:function templateSelection(e){var a,r,n,u;return e.id?(r="",e.element&&(n=t(e.element).data("avatar"))&&(r=n),r=null!==(a=e.avatar)&&void 0!==a?a:r,u=t('<span class="poly-utilities-user-search-result"><img src="'.concat(r,'" class="avatar-user"/> ').concat(e.text,"</span>"))):e.text},escapeMarkup:function escapeMarkup(t){return t}})}function fetchData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];definedWatchLoad(),Promise.all([fetchDataUsersAccess()]).then((function(e){var r,n,u,d,f=_slicedToArray(e,1),p=f[0];s.value=p,(r=null==p?void 0:p.users_access)&&(n=r.map((function(t){return{id:t.id,text:t.text,avatar:t.avatar}})),i.value=n,c.empty(),n.forEach((function(e){var a=new Option(e.text,e.id,!0,!0);t(a).data("avatar",e.avatar),c.append(a).trigger("change")}))),(u=null==p?void 0:p.users_custom_menu)&&(d=u.map((function(t){return{id:t.id,text:t.text,avatar:t.avatar}})),o.value=d,l.empty(),d.forEach((function(e){var a=new Option(e.text,e.id,!0,!0);t(a).data("avatar",e.avatar),l.append(a).trigger("change")}))),a.value=!0})).catch((function(t){}))}function fetchDataUsersAccess(){return new Promise((function(e,a){t.ajax({url:"".concat(admin_url,"poly_utilities/get_users_access_modules"),type:"GET",dataType:"json",success:function success(t){e(t)},error:function error(t,e,r){a(r)}})}))}var e,a=r(!1),n=r(!1),s=r([]),i=r([]),o=r([]),c=null,l=null;return u((function(){fetchData()})),e=function handleSubmit(e){var a,r;e.preventDefault(),n.value=!0,a={users_access:i.value,users_custom_menu:o.value},r="".concat(admin_url,"poly_utilities/update_users_access_modules"),t.post(r,a).done((function(t){PolyMessage.displayNotification(t.status,t.message)})).fail((function(t,e,a){if(401===t.status){var r=t.responseJSON;r&&r.message&&PolyMessage.displayNotification(r.status,r.message)}})).always((function(){n.value=!1}))},{dataLoaded:a,isProccessing:n,handleSubmit:e}}}).mount("#polyApp")}(jQuery)}))})();