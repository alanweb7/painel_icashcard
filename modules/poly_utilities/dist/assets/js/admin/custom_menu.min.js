(()=>{function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a,n,o,i,r,l,s,u=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=u){r=[],l=!0,s=!1;try{if(o=(u=u.call(e)).next,0===t){if(Object(u)!==u)return;l=!1}else for(;!(l=(a=o.call(u)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){s=!0,n=e}finally{try{if(!l&&null!=u.return&&(i=u.return(),Object(i)!==i))return}finally{if(s)throw n}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}window.addEventListener("load",(function(){!function(e){"use strict";var t=Vue,a=t.createApp,n=t.ref,o=t.watch,i=t.onMounted,r=t.nextTick,l=t.computed,s=a({setup:function setup(){function initDataDefault(){M.value={name:"",parent_slug:"root",target:"_self",rel:"nofollow",type:"default",badge:{color:"",value:""}}}function definedWatchLoad(){L=e(".poly-colorpicker-input-value"),D=e(".select2.roles"),N=e(".select2.users")}function updateColorPicker(){var e,t="",a=(null==M||null===(e=M.value)||void 0===e||null===(e=e.badge)||void 0===e?void 0:e.color)||t;L.val(a)}function fetchData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Promise.all([fetchDefaultSettings(),fetchMenuItems(),fetchCustomMenuItems(),fetchRoles()]).then((function(e){var t=_slicedToArray(e,4),a=t[0],n=t[1],o=t[2],i=t[3];a&&n&&o&&i&&(T.value=_toConsumableArray(n),o.forEach((function(e){if("string"==typeof e.roles&&""!==e.roles.trim())try{e.aroles=JSON.parse(e.roles)}catch(t){e.aroles=[]}else e.aroles=[];if("string"==typeof e.users&&""!==e.users.trim())try{e.ausers=JSON.parse(e.users)}catch(t){e.ausers=[]}else e.ausers=[]})),A.value=o,k.value=a,E.value=i,P.value=!0)})).catch((function(e){}))}function fetchDefaultSettings(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_default_settings"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function fetchMenuItems(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_sidebar_menu_items"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function fetchRoles(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_roles"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function updateMenuOptions(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=e("body").find("#poly-active-menu .list-group-item").not(".list-group-item.sub"),n=!1,o=[];e.each(a,(function(t,a){var i,r,l,s,u,d,c,p,f=e(this);!1===n?n=t+1:n+=1,r={},l=f.data("parent_slug"),r.name=f.data("name"),s=f.data("is_custom"),r.is_custom=null!=s&&s,r.id=f.data("id"),r.slug=f.data("slug"),r.type=f.data("type"),r.popup_description=f.data("popup_description"),r.css=f.data("css"),u=f.attr("data-disabled"),r.disabled="true"===u,r.roles=JSON.stringify(f.data("roles")),r.users=JSON.stringify(f.data("users")),r.href=null!==(i=f.data("href_original"))&&void 0!==i?i:f.data("href"),r.target=f.data("target"),r.rel=f.data("rel"),r.parent_slug=null!=l?l:"root",r.icon=f.data("icon"),r.badge=f.data("badge"),r.position=n,d=f.find(".list-group-item.sub").filter((function(){return e(this).data("parent_slug")===f.data("slug")})),c=!1,p=[],e.each(d,(function(t,a){var n,o,i,r,l,s,u,d;!1===c?c=t+1:c+=1,void 0!==(n=e(this)).data("id")&&((i={}).id=n.data("id"),i.name=n.data("name"),r=n.data("is_custom"),i.is_custom=null!=r&&r,i.slug=n.data("slug"),i.type=n.data("type"),i.popup_description=n.data("popup_description"),i.css=n.data("css"),l=n.attr("data-disabled"),i.disabled="true"===l,i.roles=JSON.stringify(n.data("roles")),i.users=JSON.stringify(n.data("users")),i.href=null!==(o=n.data("href_original"))&&void 0!==o?o:n.data("href"),i.target=n.data("target"),i.rel=n.data("rel"),i.parent_slug=n.data("parent_slug"),i.icon=n.data("icon"),i.badge=n.data("badge"),i.position=c,s=n.find(".list-group-item.sub").filter((function(){return e(this).data("parent_slug")===n.data("slug")})),u=!1,d=[],e.each(s,(function(t,a){var n,o,i,r,l;!1===u?u=t+1:u+=1,void 0!==(n=e(this)).data("id")&&((i={}).id=n.data("id"),i.name=n.data("name"),r=n.data("is_custom"),i.is_custom=null!=r&&r,i.slug=n.data("slug"),i.type=n.data("type"),i.popup_description=n.data("popup_description"),i.css=n.data("css"),l=n.attr("data-disabled"),i.disabled="true"===l,i.roles=JSON.stringify(n.data("roles")),i.users=JSON.stringify(n.data("users")),i.href=null!==(o=n.data("href_original"))&&void 0!==o?o:n.data("href"),i.target=n.data("target"),i.rel=n.data("rel"),i.parent_slug=n.data("parent_slug"),i.icon=n.data("icon"),i.badge=n.data("badge"),i.position=u,d.push(i))})),i.children=d,p.push(i))})),r.children=p,o.push(r)})),e.post(admin_url+"poly_utilities/update_sidebar_menu_positions",{data:o}).done((function(e){var a=e;t||window.location.reload(),PolyMessage.displayNotification(a.status,a.message)}))}function fetchCustomMenuItems(){return new Promise((function(t,a){e.ajax({url:"".concat(admin_url,"poly_utilities/ajax_custom_sidebar_menu_items"),type:"GET",dataType:"json",success:function success(e){Array.isArray(e)?t(e):a("Unexpected response format. Expected an array.")},error:function error(e,t,n){a(n)}})}))}function handleStaffInfo(e){window.open("".concat(admin_url,"staff/member/").concat(e.id),"_blank")}function handleRoleInfo(e){window.open("".concat(admin_url,"roles/role/").concat(e.id),"_blank")}function isEdit(e){j.value=e}function validationForm(e,t){var a,n=Object.fromEntries(e.entries()),o=!0;return n.name.trim()?t.value.name=null:(t.value.name="Title cannot be empty.",o=!1),a=["iframe"],!n.href.trim()&&a.includes(M.value.type)?(t.value.href="Href cannot be empty.",o=!1):t.value.href=null,o}var t,a,u,d,c,p,f,m,v,_,g,y,h,b,C,x,w,S,k=n([]),T=n([]),M=n({}),A=n([]),E=n([]),P=n(!1),I=n(!1),j=n(!1),O=n([]),H=n([]),D=null,N=null,L=null,R=n({});return initDataDefault(),o([T,A,E,M],(function(){r().then((function(){var a,n;definedWatchLoad(),t(),appColorPicker(),updateColorPicker(),PolyOperationFunctions.Icons(e(".poly-utilities-aio-icon-select")),D.length>0&&(D.select2({placeholder:"Select an option",width:"resolve"}),D.on("change",(function(e){var t=D.select2("data"),a=t.map((function(e){return{id:e.id,text:e.text}}));H.value=a}))),N.length>0&&(N.select2({placeholder:"Select users",width:"resolve",delay:250,minimumInputLength:2,ajax:{url:"".concat(admin_url,"poly_utilities/ajax_users_search"),dataType:"json",data:function data(e){var t;return{search:e.term,type:"public"}},processResults:function processResults(e){var t;return{results:e.map((function(e){return{id:e.staffid,text:"".concat(e.lastname," ").concat(e.firstname),avatar:e.avatar}}))}}},templateResult:function templateResult(t){return t.id?e('<div class="poly-utilities-user-search-result"><img src="'.concat(t.avatar,'" class="avatar-user"/> ').concat(t.text,"</div>")):t.text;var a},templateSelection:function templateSelection(t){var a,n,o,i;return t.id?(n="",t.element&&(o=e(t.element).data("avatar"))&&(n=o),n=null!==(a=t.avatar)&&void 0!==a?a:n,i=e('<span class="poly-utilities-user-search-result"><img src="'.concat(n,'" class="avatar-user"/> ').concat(t.text,"</span>"))):t.text},escapeMarkup:function escapeMarkup(e){return e}}),N.on("change",(function(t){var a=N.select2("data"),n=a.map((function(t){return{id:t.id,text:t.text,avatar:e(t.element).data("avatar")||t.avatar}}));O.value=n})),a={height:300,toolbar:!0,menubar:!0,branding:!1,cache_suffix:"?v="+s.version,language:s.tinymce_lang||"en",relative_urls:!1,remove_script_host:!1,paste_block_drop:!0,entity_encoding:"raw",apply_source_formatting:!1,valid_elements:"+*[*]",valid_children:"+body[style], +style[type]",table_default_styles:{width:"100%"},font_size_formats:"8pt 10pt 12pt 14pt 18pt 24pt 36pt",pagebreak_separator:'<p pagebreak="true"></p>',pagebreak_split_block:!0,plugins:["quickbars","advlist","autolink","lists","link","image","visualblocks","code","pagebreak","searchreplace","media","table"],autoresize_bottom_margin:50,quickbars_insert_toolbar:"image media quicktable | bullist numlist | h2 h3 | pagebreak | hr",quickbars_selection_toolbar:"bold italic underline superscript | forecolor backcolor link | alignleft aligncenter alignright alignjustify | fontfamily fontsize | h2 h3",contextmenu:"paste pastetext copy searchreplace | visualblocks pagebreak | code"},init_editor("#popup_description",n=a))}))})),i((function(){fetchData(),e(document).on("click",".list-group.nested-sortable",(function(t){var a,n,o,i;t.preventDefault(),t.stopPropagation(),o=(n=(a=e(t.target)).closest("div")).find(".toggle-widgets i"),(i=n.find(".list-group.nested-sortable").first()).length&&(i.slideToggle(),o.hasClass("fa-caret-up")?o.removeClass("fa-caret-up").addClass("fa-caret-down"):o.removeClass("fa-caret-down").addClass("fa-caret-up"))}))})),t=function setupSortable(){var e,t=[].slice.call(document.querySelectorAll(".poly-menu .nested-sortable"));for(e=0;e<t.length;e++)new Sortable(t[e],{group:"poly-menu",animation:150,fallbackOnBody:!0,swapThreshold:.65,onStart:function onStart(e){var t=e.item},onAdd:function onAdd(e){var t,a=e.item,n=a.parentNode;n.classList.contains("list-group")&&(null!==(t=n.parentNode.getAttribute("data-slug"))?(a.classList.add("sub"),a.setAttribute("data-parent_slug",t)):(a.setAttribute("data-parent_slug","root"),a.classList.remove("sub")))},onEnd:function onEnd(e){updateMenuOptions()}})},a=function handleSubmit(t){var a,n;if(I.value=!0,a=e("#poly_utilities_add_custom_sidebar_form").get(0),!validationForm(n=new FormData(a),R))return I.value=!1,!1;n.set("users",JSON.stringify(O.value)),n.set("roles",JSON.stringify(H.value)),n.append("is_edit",j.value),n.append("is_custom","true"),!0===j.value&&(n.append("id",M.value.id),n.append("slug",M.value.slug),n.append("position",M.value.position)),"popup"==M.value.type&&PolyCommon.isElementExist("#popup_description")&&(tinyMCE.activeEditor?n.append("popup_description",tinyMCE.activeEditor.getContent()):n.append("popup_description",e("#popup_description").val())),fetch(a.action,{method:"POST",body:n}).then((function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(e){j.value?(window.location.reload(),PolyMessage.displayNotification("".concat(e.status),"".concat(e.message))):window.location.reload()})).catch((function(e){})).finally((function(){I.value=!1}))},u=function initDefaultValue(e){var t,a,n,o,i,r,l,s,u,d;e.type=null!==(t=e.type)&&void 0!==t?t:"default",e.target=null!==(a=e.target)&&void 0!==a?a:"_self",e.rel=null!==(n=e.rel)&&void 0!==n?n:"follow",e.parent_slug=null!==(o=null==e?void 0:e.parent_slug)&&void 0!==o?o:"root",e.href=null!==(i=null==e?void 0:e.href_original)&&void 0!==i?i:e.href,d=null!==(r=null==e?void 0:e.position)&&void 0!==r?r:0,d=parseInt(d),e.position=d,e.icon=null!==(l=null==e?void 0:e.svg)&&void 0!==l?l:e.icon,e.badge||(e.badge={}),e.badge.value=null!==(s=e.badge.value)&&void 0!==s?s:"",e.badge.color=null!==(u=e.badge.color)&&void 0!==u?u:""},d=function handleClone(t){var a,n,o,i,r=t.id+"_cloned";t.id=r,t.slug=r,t.is_custom=!0,u(t),t.name=PolyCommon.extractTextFromHtml(t.name),t.badge={color:null!==(a=null==t||null===(n=t.badge)||void 0===n?void 0:n.color)&&void 0!==a?a:"",value:null!==(o=null==t||null===(i=t.badge)||void 0===i?void 0:i.value)&&void 0!==o?o:""},e.post(admin_url+"poly_utilities/clone_sidebar_menu",{data:t}).done((function(e){var t=e;PolyMessage.displayNotification(t.status,t.message),fetchData()}))},c=function decodeHtml(e){return PolyCustomMenu.decodeHtml(e)},p=function handleIcon(e){var t=PolyCustomMenu.decodeHtml(e.icon);return t.includes("<svg")?t:'<i class="'.concat(e.icon,'">&nbsp;</i>')},f=function handleEdit(t){var a,n,o,i,r,l,s,d;PolyOperationFunctions.Scrolling(),j.value=!0,"iframe"===t.type&&t.href_original&&(t.href=t.href_original),"popup"===t.type&&PolyCommon.isElementExist("#popup_description")&&(tinyMCE.activeEditor?setTimeout((function(){tinyMCE.activeEditor.setContent(PolyCustomMenu.decodeHtml(t.popup_description))}),300):e("#popup_description").val(PolyCustomMenu.decodeHtml(t.popup_description))),t.roles=null!==(a=null==t?void 0:t.roles)&&void 0!==a?a:"[]",t.users=null!==(n=null==t?void 0:t.users)&&void 0!==n?n:"[]",u(t),M.value=t,null!=t&&t.icon&&(o=PolyCustomMenu.decodeHtml(t.icon)).includes("<svg")&&(M.value.svg=t.icon,M.value.icon=""),M.value.name=PolyCommon.extractTextFromHtml(M.value.name),r=(i=JSON.parse(t.roles)).map((function(e){return{id:e.id,text:e.text}})),H.value=r,l=r.map((function(e){return e.id})),D.val(l).trigger("change"),d=(s=JSON.parse(t.users)).map((function(e){return{id:e.id,text:e.text,avatar:e.avatar}})),O.value=d,N.empty(),d.forEach((function(t){var a=new Option(t.text,t.id,!0,!0);e(a).data("avatar",t.avatar),N.append(a)})),updateColorPicker()},m=PolyComponents.useFilteredTypes(M,k),v=function handleChangeLinkType(t){var a,n;t.type,"divider"===t.type&&(a="fa-solid fa-grip-lines fa-fw",e("#name").val("Divider"),e("#badge\\[value\\]").val("2px"),e("#badge\\[color\\]").val("transparent"),e('textarea[name="icon"]').val(a),(n=e("#poly_field_aio_supports_button i")).length>0&&(n.removeClass(),n.addClass(a)))},_=function handleDelete(t){var a={};a.id=t.slug,Swal.fire({title:poly_utilities_settings.popup_delete.header,text:poly_utilities_settings.popup_delete.message,showCancelButton:!0,confirmButtonColor:poly_utilities_settings.popup_delete.confirm_color,cancelButtonColor:poly_utilities_settings.popup_delete.cancel_color,cancelButtonText:poly_utilities_settings.popup_delete.cancel,confirmButtonText:poly_utilities_settings.popup_delete.confirm,allowOutsideClick:!1}).then((function(t){t.isConfirmed&&e.post(admin_url+"poly_utilities/delete_custom_sidebar_menu",a).done((function(e){window.location.reload()}))}))},g=function handleResetCustomMenu(e){PolyCustomMenu.HandleResetCustomMenu(e)},y=function handleReactivationModule(){PolyCustomMenu.handleReactivationModule()},h=function handleDisabled(t,a){var n,o;t.preventDefault(),(n=e(t.target).closest(".onoffswitch").find('input[type="checkbox"]')).length&&(o=!n.prop("checked"),n.prop("checked",o),a.disabled=o,r().then((function(){updateMenuOptions(!0)})))},b=function handleDividerStyles(e){return PolyCustomMenu.HandleDividerStyles(e)},C=function handleHtmlContent(e){return PolyCustomMenu.HandleHtmlContent(e)},x=function extractTextFromHtml(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},w=function removeIcon(e){null!=e&&e.icon&&(e.icon=""),null!=e&&e.svg&&(e.svg="")},S=l((function(){var e=[];return T.value.forEach((function(t){"divider"!==t.type&&t.slug!==M.value.slug&&(e.push({name:t.name,slug:t.slug,prefix:""}),t.children&&t.children.length>0&&t.children.forEach((function(t){t.slug!==M.value.slug&&e.push({name:t.name,slug:t.slug,prefix:"---"})})))})),e})),{dataLoaded:P,isProccessing:I,validation_fields:R,default_settings:k,menu_items:T,flattenedMenuItems:S,custom_menu_items:A,roles:E,item_edit_object:M,is_edit:j,isEdit,handleEdit:f,decodeHtml:c,handleIcon:p,handleClone:d,handleDelete:_,handleDisabled:h,handleSubmit:a,handleStaffInfo,handleRoleInfo,handleDividerStyles:b,handleReactivationModule:y,handleHtmlContent:C,extractTextFromHtml:x,handleResetCustomMenu:g,handleChangeLinkType:v,filteredTypes:m,removeIcon:w}}}).mount("#polyApp")}(jQuery)}))})();