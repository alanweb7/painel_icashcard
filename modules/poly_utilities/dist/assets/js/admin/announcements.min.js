(()=>{function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a,n,i,o,r,l,u,c=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=c){r=[],l=!0,u=!1;try{if(i=(c=c.call(e)).next,0===t){if(Object(c)!==c)return;l=!1}else for(;!(l=(a=i.call(c)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){u=!0,n=e}finally{try{if(!l&&null!=c.return&&(o=c.return(),Object(o)!==o))return}finally{if(u)throw n}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}window.addEventListener("load",(function(){!function(e){"use strict";var t=Vue,a=t.createApp,n=t.ref,i=t.watch,o=t.onMounted,r=t.nextTick,l=PolyCommon.siteUrl(),u=a({setup:function setup(){function initData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];T.value=!0,Promise.all([fetchWidgetsArea(),fetchBanners(j.value,N.value)]).then((function(e){var t=_slicedToArray(e,2),a=t[0],n=t[1];p.value=a,_.value=n.banners,S.value=n.total_pages,x.value=n.data_info})).catch((function(e){})).finally((function(){T.value=!1,P.value=!0}))}function validationForm(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#poly_utilities_ext_form",a=PolyForm.getEntries(t),n=!0;return a.title.trim()?M.value.title=null:(M.value.title="Title is required",n=!1),null!=a&&a["area[]"]&&0!==a["area[]"].length?M.value.area=null:(M.value.area="Widgets area is required",n=!1),(e=PolyDate.daysBetween(a.date_from,a.date_to))&&e<0?(M.value.date="Invalid date range",n=!1):M.value.date=null,n}function fetchWidgetsArea(){return new Promise((function(t,a){e.ajax({url:"".concat(l,"poly_utilities/ajax_widgets_area"),type:"GET",dataType:"json",success:function success(e){t(e)},error:function error(e,t,n){a(n)}})}))}function fetchBanners(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return new Promise((function(n,i){e.ajax({url:"".concat(l,"poly_utilities/ajax_banners_announcements"),type:"GET",data:{page:t,items_per_page:a},dataType:"json",success:function success(e){n(e)},error:function error(e,t,a){i(a)}})}))}var t,a,u,c,s,d,f,v,y,m,h,g,p=n([]),_=n([]),w=n([]),b=n(!0),P=n(!1),A=n(!1),T=n(!1),D=n(!1),S=n(1),j=n(1),x=n(""),N=n(10),M=n({title:null,area:null,date:null}),k=null,F="#poly_utilities_ext_modal";return o((function(){initData()})),t=function changePage(e){j.value=e,initData(),PolyOperationFunctions.Scrolling(".dataTables_wrapper")},a=function DaysBetween(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"days",n=PolyDate.daysBetween(e,t);return isNaN(n)||null==n?n:(n=Number(n),"".concat(PolyCommon.formatNumberWithSeparator(n,".")," ").concat(a))},u=function resetValidationFields(){M.value.title=null,M.value.area=null,M.value.date=null},c=function resetFields(){u(),w.value=[],k.length>0&&k.select2({placeholder:"Select area",width:"resolve"}),k.val("").trigger("change")},s=function manageSubmit(t){var a,n;if(D.value=!0,!validationForm())return D.value=!1,!1;a=e("#poly_utilities_ext_form").get(0),n=new FormData(a),PolyHandleRequest.customFetch(a.action,{method:"POST",body:n}).then((function(e){if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((function(e){200===e.code?""!=w.value?(PolyMessage.displayNotification("success",e.message),initData()):(window.location.reload(),PolyMessage.displayNotification("success",e.message)):PolyMessage.displayNotification("error",e.message)})).catch((function(e){PolyMessage.displayNotification("error","There was a problem with the fetch operation.")})).finally((function(){D.value=!1}))},d=function WidgetsArea(e){var t,a=e.area;return a?t=p.value.filter((function(e){return a.includes(e.id)})):[]},f=function handleActiveStatus(t){var a,n="".concat(admin_url,"poly_utilities/update_announcement_status");t.active=1==t.active?0:1,a={active:t.active,id:t.id},e.post(n,a).done((function(e){PolyMessage.displayNotification(e.status,e.message),initData()})).fail((function(e,t,a){PolyMessage.displayNotification("error","There was a problem updating the status.")}))},v=function handleAdd(){A.value=!1,c(),w.value=[],w.value.date_from=new Date,w.value.target="_blank",w.value.rel="nofollow",e("#poly_utilities_ext_modal").modal("show")},y=function decodeHtml(e){return PolyCustomMenu.decodeHtml(e)},m=function handleEdit(t){A.value=!0,w.value=t,w.value.content&&(w.value.content=PolyCustomMenu.decodeHtml(w.value.content)),e("".concat(F)).modal("show"),e("".concat(F," .select2")).select2(),e("".concat(F," .select2")).val(t.area).trigger("change")},h=function handleDelete(t){var a="".concat(admin_url,"poly_utilities/delete_announcement");Swal.fire({title:"Delete announcement",text:"The action after confirmation cannot be undone!",showCancelButton:!0,allowOutsideClick:!1}).then((function(n){n.isConfirmed&&e.post(a,{id:t.id}).done((function(e){initData()})).fail((function(e){}))}))},g=function DataValidation(){e(".select2").on("change",(function(e){validationForm()})),e('input[name="date_from"], input[name="date_to"]').on("change",(function(){var e=PolyValidation.isValidRangeDate("date_from","date_to");b.value=e>=0,M.value.date="".concat(e," days")}))},i([p],(function(){r().then((function(){k=e(".select2.area"),g()}))})),{is_edit:A,validation_fields:M,dataLoaded:P,isProccessing:T,isUpdateProccessing:D,widgets_area:p,data_banners:_,handle_item:w,rangeDateValid:b,handleAdd:v,handleEdit:m,handleActiveStatus:f,handleDelete:h,manageSubmit:s,WidgetsArea:d,DaysBetween:a,decodeHtml:y,changePage:t,dataInfo:x,totalPages:S,currentPage:j,itemsPerPage:N}}}).mount("#polyApp")}(jQuery)}))})();