(()=>{function _slicedToArray(e,a){return _arrayWithHoles(e)||_iterableToArrayLimit(e,a)||_unsupportedIterableToArray(e,a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,a){if(e){if("string"==typeof e)return _arrayLikeToArray(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,a):void 0}}function _arrayLikeToArray(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,a){var t,n,i,o,l,r,u,c=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=c){l=[],r=!0,u=!1;try{if(i=(c=c.call(e)).next,0===a){if(Object(c)!==c)return;r=!1}else for(;!(r=(t=i.call(c)).done)&&(l.push(t.value),l.length!==a);r=!0);}catch(e){u=!0,n=e}finally{try{if(!r&&null!=c.return&&(o=c.return(),Object(o)!==o))return}finally{if(u)throw n}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}window.addEventListener("load",(function(){!function(e){"use strict";var a=Vue,t=a.createApp,n=a.ref,i=a.watch,o=a.onMounted,l=a.nextTick,r=PolyCommon.siteUrl(),u=t({setup:function setup(){function initData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];F.value=!0,Promise.all([fetchWidgetsArea(),fetchBanners(j.value,N.value)]).then((function(e){var a=_slicedToArray(e,2),t=a[0],n=a[1];_.value=t,b.value=n.banners,x.value=n.total_pages,I.value=n.data_info})).catch((function(e){})).finally((function(){F.value=!1,T.value=!0}))}function validationForm(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#poly_utilities_ext_form",t=PolyForm.getEntries(a),n=!0;return t.title.trim()?M.value.title=null:(M.value.title="Title is required",n=!1),t&&t["area[]"]&&0!==t["area[]"].length?M.value.area=null:(M.value.area="Widgets area is required",n=!1),(e=PolyDate.daysBetween(t.date_from,t.date_to))&&e<0?(M.value.date="Invalid date range",n=!1):M.value.date=null,n}function fetchWidgetsArea(){return new Promise((function(a,t){e.ajax({url:"".concat(r,"poly_utilities/ajax_widgets_area"),type:"GET",dataType:"json",success:function success(e){a(e)},error:function error(e,a,n){t(n)}})}))}function fetchBanners(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return new Promise((function(n,i){e.ajax({url:"".concat(r,"poly_utilities/ajax_banners"),type:"GET",data:{page:a,items_per_page:t},dataType:"json",success:function success(e){n(e)},error:function error(e,a,t){i(t)}})}))}var a,t,u,c,s,d,f,m,v,y,h,g,p,_=n([]),b=n([]),w=n([]),P=n(""),A=n(!0),T=n(!1),D=n(!1),F=n(!1),S=n(!1),x=n(1),j=n(1),I=n(""),N=n(10),M=n({title:null,area:null,date:null}),k=null,E="#poly_utilities_ext_modal";return o((function(){initData(),p()})),a=function changePage(e){j.value=e,initData(),PolyOperationFunctions.Scrolling(".dataTables_wrapper")},t=function DaysBetween(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"days",n=PolyDate.daysBetween(e,a);return isNaN(n)||null==n?n:(n=Number(n),"".concat(PolyCommon.formatNumberWithSeparator(n,".")," ").concat(t))},u=function resetValidationFields(){M.value.title=null,M.value.area=null,M.value.date=null},c=function resetFields(){u(),w.value=[],k.length>0&&k.select2({placeholder:"Select area",width:"resolve"}),k.val("").trigger("change")},s=function manageSubmit(a){var t,n;if(S.value=!0,!validationForm())return S.value=!1,!1;!PolyForm.isBase64Image(w.value.media)&&PolyForm.fileUploadInput("".concat(E))&&PolyForm.clearFileUpload("".concat(E)),t=e("#poly_utilities_ext_form").get(0),n=new FormData(t),PolyHandleRequest.customFetch(t.action,{method:"POST",body:n}).then((function(e){if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((function(e){200===e.code?""!=w.value?(PolyMessage.displayNotification("success",e.message),PolyForm.clearFileUpload("".concat(E)),w.value.media=e.data.media,initData()):(window.location.reload(),PolyMessage.displayNotification("success",e.message)):PolyMessage.displayNotification("error",e.message)})).catch((function(e){PolyMessage.displayNotification("error","There was a problem with the fetch operation.")})).finally((function(){S.value=!1}))},d=function WidgetsArea(e){var a,t=e.area;return t?a=_.value.filter((function(e){return t.includes(e.id)})):[]},f=function handleActiveStatus(a){var t,n="".concat(admin_url,"poly_utilities/update_banner_status");a.active=1==a.active?0:1,t={active:a.active,id:a.id},e.post(n,t).done((function(e){PolyMessage.displayNotification(e.status,e.message),initData()})).fail((function(e,a,t){PolyMessage.displayNotification("error","There was a problem updating the status.")}))},m=function handleAdd(){D.value=!1,c(),w.value=[],w.value.date_from=new Date,w.value.target="_blank",w.value.rel="nofollow",e("#poly_utilities_ext_modal").modal("show")},v=function decodeHtml(e){return PolyCustomMenu.decodeHtml(e)},y=function handleEdit(a){D.value=!0,w.value=a,P.value=w.value.media,w.value.embed&&(w.value.embed=PolyCustomMenu.decodeHtml(w.value.embed)),e("".concat(E)).modal("show"),e("".concat(E," .select2")).select2(),e("".concat(E," .select2")).val(a.area).trigger("change")},h=function handleDelete(a){var t="".concat(admin_url,"poly_utilities/delete_banner");Swal.fire({title:"Delete banner",text:"The action after confirmation cannot be undone!",showCancelButton:!0,allowOutsideClick:!1}).then((function(n){n.isConfirmed&&e.post(t,{id:a.id}).done((function(e){initData()})).fail((function(e){}))}))},g=function DataValidation(){e(".select2").on("change",(function(e){validationForm()})),e('input[name="date_from"], input[name="date_to"]').on("change",(function(){var e=PolyValidation.isValidRangeDate("date_from","date_to");A.value=e>=0,M.value.date="".concat(e," days")}))},i([_],(function(){l().then((function(){k=e(".select2.area"),g(),P.value=w.value.media}))})),p=function setupEventListeners(){e("#file").on("change",(function(a){var t,n=e(this).data("no-file-message"),i=this,o=i.files.length>0?i.files[0].name:n;e("#file-name").text(o),i.files&&i.files[0]?((t=new FileReader).onload=function(e){w.value.media=e.target.result},t.readAsDataURL(i.files[0])):(w.value.media=null,e("#file-name").text(n))})),e("".concat(E)).on("shown.bs.modal",(function(){PolyForm.clearFileUpload("".concat(E))})),e("".concat(E)).on("hidden.bs.modal",(function(){w.value.media=P.value}))},{is_edit:D,validation_fields:M,dataLoaded:T,isProccessing:F,isUpdateProccessing:S,widgets_area:_,data_banners:b,handle_item:w,rangeDateValid:A,handleAdd:m,handleEdit:y,handleActiveStatus:f,handleDelete:h,manageSubmit:s,WidgetsArea:d,DaysBetween:t,decodeHtml:v,changePage:a,dataInfo:I,totalPages:x,currentPage:j,itemsPerPage:N}}}).mount("#polyApp")}(jQuery)}))})();