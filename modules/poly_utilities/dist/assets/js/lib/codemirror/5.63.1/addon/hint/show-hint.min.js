var t;t=function(o){"use strict";function n(o,s){var c;this.cm=o,this.options=s,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length,this.options.updateOnCursorActivity&&o.on("cursorActivity",(c=this).activityFunc=function(){c.cursorActivity()})}function M(o){return"string"==typeof o?o:o.text}function O(o,s){for(;s&&s!=o;){if("LI"===s.nodeName.toUpperCase()&&s.parentNode==o)return s;s=s.parentNode}}function i(s,c){var l,a,u,d,f,p,m,g,v,y,b,w,A,H,C,k,x,S,T,F,N,I,P,E,W;for(this.id="cm-complete-"+Math.floor(Math.random(1e6)),this.completion=s,this.data=c,this.picked=!1,l=this,a=s.cm,u=a.getInputField().ownerDocument,d=u.defaultView||u.parentWindow,(f=this.hints=u.createElement("ul")).setAttribute("role","listbox"),f.setAttribute("aria-expanded","true"),f.id=this.id,p=s.cm.options.theme,f.className="CodeMirror-hints "+p,this.selectedHint=c.selectedHint||0,m=c.list,g=0;g<m.length;++g)v=f.appendChild(u.createElement("li")),y=m[g],b="CodeMirror-hint"+(g!=this.selectedHint?"":" "+h),null!=y.className&&(b=y.className+" "+b),v.className=b,g==this.selectedHint&&v.setAttribute("aria-selected","true"),v.id=this.id+"-"+g,v.setAttribute("role","option"),y.render?y.render(v,c,y):v.appendChild(u.createTextNode(y.displayText||M(y))),v.hintId=g;if(w=s.options.container||u.body,A=a.cursorCoords(s.options.alignWithWord?c.from:null),H=A.left,C=A.bottom,k=!0,x=0,S=0,w!==u.body&&(T=(I=-1!==["absolute","relative","fixed"].indexOf(d.getComputedStyle(w).position)?w:w.offsetParent).getBoundingClientRect(),N=u.body.getBoundingClientRect(),x=T.left-N.left-I.scrollLeft,S=T.top-N.top-I.scrollTop),f.style.left=H-x+"px",f.style.top=C-S+"px",p=d.innerWidth||Math.max(u.body.offsetWidth,u.documentElement.offsetWidth),T=d.innerHeight||Math.max(u.body.offsetHeight,u.documentElement.offsetHeight),w.appendChild(f),a.getInputField().setAttribute("aria-autocomplete","list"),a.getInputField().setAttribute("aria-owns",this.id),a.getInputField().setAttribute("aria-activedescendant",this.id+"-"+this.selectedHint),N=s.options.moveOnOverlap?f.getBoundingClientRect():new DOMRect,I=!!s.options.paddingForScrollbar&&f.scrollHeight>f.clientHeight+1,setTimeout((function(){F=a.getScrollInfo()})),0<N.bottom-T&&(w=N.bottom-N.top,0<A.top-(A.bottom-N.top)-w?(f.style.top=(C=A.top-w-S)+"px",k=!1):T<w&&(f.style.height=T-5+"px",f.style.top=(C=A.bottom-N.top-S)+"px",E=a.getCursor(),c.from.ch!=E.ch&&(A=a.cursorCoords(E),f.style.left=(H=A.left-x)+"px",N=f.getBoundingClientRect()))),E=N.right-p,I&&(E+=a.display.nativeBarWidth),0<E&&(N.right-N.left>p&&(f.style.width=p-5+"px",E-=N.right-N.left-p),f.style.left=(H=A.left-E-x)+"px"),I)for(W=f.firstChild;W;W=W.nextSibling)W.style.paddingRight=a.display.nativeBarWidth+"px";return a.addKeyMap(this.keyMap=function(o,s){function i(o,c){var h="string"!=typeof c?function(o){return c(o,s)}:u.hasOwnProperty(c)?u[c]:c;l[o]=h}var c,l,h,a,u={Up:function(){s.moveFocus(-1)},Down:function(){s.moveFocus(1)},PageUp:function(){s.moveFocus(1-s.menuSize(),!0)},PageDown:function(){s.moveFocus(s.menuSize()-1,!0)},Home:function(){s.setFocus(0)},End:function(){s.setFocus(s.length-1)},Enter:s.pick,Tab:s.pick,Esc:s.close};if(/Mac/.test(navigator.platform)&&(u["Ctrl-P"]=function(){s.moveFocus(-1)},u["Ctrl-N"]=function(){s.moveFocus(1)}),c=o.options.customKeys,l=c?{}:u,c)for(h in c)c.hasOwnProperty(h)&&i(h,c[h]);if(a=o.options.extraKeys)for(h in a)a.hasOwnProperty(h)&&i(h,a[h]);return l}(s,{moveFocus:function(o,s){l.changeActive(l.selectedHint+o,s)},setFocus:function(o){l.changeActive(o)},menuSize:function(){return l.screenAmount()},length:m.length,close:function(){s.close()},pick:function(){l.pick()},data:c})),s.options.closeOnUnfocus&&(a.on("blur",this.onBlur=function(){P=setTimeout((function(){s.close()}),100)}),a.on("focus",this.onFocus=function(){clearTimeout(P)})),a.on("scroll",this.onScroll=function(){var o,c,l=a.getScrollInfo(),h=a.getWrapperElement().getBoundingClientRect();if(F=F||a.getScrollInfo(),c=(o=C+F.top-l.top)-(d.pageYOffset||(u.documentElement||u.body).scrollTop),k||(c+=f.offsetHeight),c<=h.top||c>=h.bottom)return s.close();f.style.top=o+"px",f.style.left=H+F.left-l.left+"px"}),o.on(f,"dblclick",(function(o){(o=O(f,o.target||o.srcElement))&&null!=o.hintId&&(l.changeActive(o.hintId),l.pick())})),o.on(f,"click",(function(o){(o=O(f,o.target||o.srcElement))&&null!=o.hintId&&(l.changeActive(o.hintId),s.options.completeOnSingleClick&&l.pick())})),o.on(f,"mousedown",(function(){setTimeout((function(){a.focus()}),20)})),0===(I=this.getSelectedHintRange()).from&&0===I.to||this.scrollToActive(),o.signal(c,"select",m[this.selectedHint],f.childNodes[this.selectedHint]),!0}function r(o,s,c,l){o.async?o(s,l,c):(c=o(s,c))&&c.then?c.then(l):l(c)}var s,c,l,h="CodeMirror-hint-active";o.showHint=function(o,s,c){var l,h;if(!s)return o.showHint(c);if(c&&c.async&&(s.async=!0),l={hint:s},c)for(h in c)l[h]=c[h];return o.showHint(l)},o.defineExtension("showHint",(function(s){var c,h;if(s=function(o,s,c){var h,a=o.options.hintOptions,u={};for(h in l)u[h]=l[h];if(a)for(h in a)void 0!==a[h]&&(u[h]=a[h]);if(c)for(h in c)void 0!==c[h]&&(u[h]=c[h]);return u.hint.resolve&&(u.hint=u.hint.resolve(o,s)),u}(this,this.getCursor("start"),s),!(1<(c=this.listSelections()).length)){if(this.somethingSelected()){if(!s.hint.supportsSelection)return;for(h=0;h<c.length;h++)if(c[h].head.line!=c[h].anchor.line)return}this.state.completionActive&&this.state.completionActive.close(),(s=this.state.completionActive=new n(this,s)).options.hint&&(o.signal(this,"startCompletion",this),s.update(!0))}})),o.defineExtension("closeHint",(function(){this.state.completionActive&&this.state.completionActive.close()})),s=window.requestAnimationFrame||function(o){return setTimeout(o,1e3/60)},c=window.cancelAnimationFrame||clearTimeout,n.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.options.updateOnCursorActivity&&this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&o.signal(this.data,"close"),this.widget&&this.widget.close(),o.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(s,c){var l=s.list[c],h=this;this.cm.operation((function(){l.hint?l.hint(h.cm,s,l):h.cm.replaceRange(M(l),l.from||s.from,l.to||s.to,"complete"),o.signal(s,"pick",l),h.cm.scrollIntoView()})),this.options.closeOnPick&&this.close()},cursorActivity:function(){var o,l,h,a;this.debounce&&(c(this.debounce),this.debounce=0),o=this.startPos,this.data&&(o=this.data.from),h=this.cm.getCursor(),a=this.cm.getLine(h.line),h.line!=this.startPos.line||a.length-h.ch!=this.startLen-this.startPos.ch||h.ch<o.ch||this.cm.somethingSelected()||!h.ch||this.options.closeCharacters.test(a.charAt(h.ch-1))?this.close():((l=this).debounce=s((function(){l.update()})),this.widget&&this.widget.disable())},update:function(o){var s,c;null!=this.tick&&(c=++(s=this).tick,r(this.options.hint,this.cm,this.options,(function(l){s.tick==c&&s.finishUpdate(l,o)})))},finishUpdate:function(s,c){this.data&&o.signal(this.data,"update"),c=this.widget&&this.widget.picked||c&&this.options.completeSingle,this.widget&&this.widget.close(),(this.data=s)&&s.list.length&&(c&&1==s.list.length?this.pick(s,0):(this.widget=new i(this,s),o.signal(s,"shown")))}},i.prototype={close:function(){var o;this.completion.widget==this&&(this.completion.widget=null,this.hints.parentNode&&this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap),(o=this.completion.cm.getInputField()).removeAttribute("aria-activedescendant"),o.removeAttribute("aria-owns"),o=this.completion.cm,this.completion.options.closeOnUnfocus&&(o.off("blur",this.onBlur),o.off("focus",this.onFocus)),o.off("scroll",this.onScroll))},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var o=this;this.keyMap={Enter:function(){o.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(s,c){s>=this.data.list.length?s=c?this.data.list.length-1:0:s<0&&(s=c?0:this.data.list.length-1),this.selectedHint!=s&&((c=this.hints.childNodes[this.selectedHint])&&(c.className=c.className.replace(" "+h,""),c.removeAttribute("aria-selected")),(c=this.hints.childNodes[this.selectedHint=s]).className+=" "+h,c.setAttribute("aria-selected","true"),this.completion.cm.getInputField().setAttribute("aria-activedescendant",c.id),this.scrollToActive(),o.signal(this.data,"select",this.data.list[this.selectedHint],c))},scrollToActive:function(){var o=this.getSelectedHintRange(),s=this.hints.childNodes[o.from],c=this.hints.childNodes[o.to],o=this.hints.firstChild;s.offsetTop<this.hints.scrollTop?this.hints.scrollTop=s.offsetTop-o.offsetTop:c.offsetTop+c.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=c.offsetTop+c.offsetHeight-this.hints.clientHeight+o.offsetTop)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1},getSelectedHintRange:function(){var o=this.completion.options.scrollMargin||0;return{from:Math.max(0,this.selectedHint-o),to:Math.min(this.data.list.length-1,this.selectedHint+o)}}},o.registerHelper("hint","auto",{resolve:function(s,c){var l,h=s.getHelpers(c,"hint");return h.length?(c=function(o,s,c){var l=function(o,s){if(!o.somethingSelected())return s;for(var c=[],l=0;l<s.length;l++)s[l].supportsSelection&&c.push(s[l]);return c}(o,h);!function e(h){if(h==l.length)return s(null);r(l[h],o,c,(function(o){o&&0<o.list.length?s(o):e(h+1)}))}(0)},c.async=!0,c.supportsSelection=!0,c):(l=s.getHelper(s.getCursor(),"hintWords"))?function(s){return o.hint.fromList(s,{words:l})}:o.hint.anyword?function(s,c){return o.hint.anyword(s,c)}:function(){}}}),o.registerHelper("hint","fromList",(function(s,c){var l,h,a,u,d=s.getCursor(),f=s.getTokenAt(d),p=o.Pos(d.line,f.start);for(s=d,f.start<d.ch&&/\w/.test(f.string.charAt(d.ch-f.start-1))?l=f.string.substr(0,d.ch-f.start):(l="",p=d),h=[],a=0;a<c.words.length;a++)(u=c.words[a]).slice(0,l.length)==l&&h.push(u);if(h.length)return{list:h,from:p,to:s}})),o.commands.autocomplete=o.showHint,l={hint:o.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnPick:!0,closeOnUnfocus:!0,updateOnCursorActivity:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null,paddingForScrollbar:!0,moveOnOverlap:!0},o.defineOption("hintOptions",null)},"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror);