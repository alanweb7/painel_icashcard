var t;t=function(n){function y(n){return n&&n.bracketRegex||/[(){}[\]]/}function f(n,r,l){var u,m=n.getLineHandle(r.line),g=r.ch-1,d=l&&l.afterCursor;return null==d&&(d=/(^| )cm-fat-cursor($| )/.test(n.getWrapperElement().className)),u=y(l),(d=!d&&0<=g&&u.test(m.text.charAt(g))&&h[m.text.charAt(g)]||u.test(m.text.charAt(g+1))&&h[m.text.charAt(++g)])?(u=">"==d.charAt(1)?1:-1,l&&l.strict&&0<u!=(g==r.ch)?null:(m=n.getTokenTypeAt(a(r.line,g+1)),null==(l=o(n,a(r.line,g+(0<u?1:0)),u,m,l))?null:{from:a(r.line,g),to:l&&l.pos,match:l&&l.ch==d.charAt(0),forward:0<u})):null}function o(n,r,l,u,m){var g,d,k,p,x,B,A,L,b,v,M;for(g=m&&m.maxScanLineLength||1e4,d=m&&m.maxScanLines||1e3,k=[],p=y(m),x=0<l?Math.min(r.line+d,n.lastLine()+1):Math.max(n.firstLine()-1,r.line-d),B=r.line;B!=x;B+=l)if((A=n.getLine(B))&&(L=0<l?0:A.length-1,b=0<l?A.length:-1,!(A.length>g)))for(B==r.line&&(L=r.ch-(l<0?1:0));L!=b;L+=l)if(v=A.charAt(L),p.test(v)&&(void 0===u||(n.getTokenTypeAt(a(B,L+1))||"")==(u||"")))if((M=h[v])&&">"==M.charAt(1)==0<l)k.push(v);else{if(!k.length)return{pos:a(B,L),ch:v};k.pop()}return B-l!=(0<l?n.lastLine():n.firstLine())&&null}function e(n,h,l){var u,m,g,d,k,p,x;for(u=n.state.matchBrackets.maxHighlightLineLength||1e3,m=l&&l.highlightNonMatching,g=[],d=n.listSelections(),k=0;k<d.length;k++)(x=d[k].empty()&&f(n,d[k].head,l))&&(x.match||!1!==m)&&n.getLine(x.from.line).length<=u&&(p=x.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",g.push(n.markText(x.from,a(x.from.line,x.from.ch+1),{className:p})),x.to&&n.getLine(x.to.line).length<=u&&g.push(n.markText(x.to,a(x.to.line,x.to.ch+1),{className:p})));if(g.length){function s(){n.operation((function(){for(var n=0;n<g.length;n++)g[n].clear()}))}if(r&&n.state.focused&&n.focus(),!h)return s;setTimeout(s,800)}}function i(n){n.operation((function(){n.state.matchBrackets.currentlyHighlighted&&(n.state.matchBrackets.currentlyHighlighted(),n.state.matchBrackets.currentlyHighlighted=null),n.state.matchBrackets.currentlyHighlighted=e(n,!1,n.state.matchBrackets)}))}function c(n){n.state.matchBrackets&&n.state.matchBrackets.currentlyHighlighted&&(n.state.matchBrackets.currentlyHighlighted(),n.state.matchBrackets.currentlyHighlighted=null)}var r=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),a=n.Pos,h={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};n.defineOption("matchBrackets",!1,(function(r,a,h){h&&h!=n.Init&&(r.off("cursorActivity",i),r.off("focus",i),r.off("blur",c),c(r)),a&&(r.state.matchBrackets="object"==typeof a?a:{},r.on("cursorActivity",i),r.on("focus",i),r.on("blur",c))})),n.defineExtension("matchBrackets",(function(){e(this,!0)})),n.defineExtension("findMatchingBracket",(function(n,r,a){return f(this,n,r=a||"boolean"==typeof r?a?(a.strict=r,a):r?{strict:!0}:null:r)})),n.defineExtension("scanForBracket",(function(n,r,a,h){return o(this,n,r,a,h)}))},"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror);