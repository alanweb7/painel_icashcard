var t;t=function(e){"use strict";function m(e,n){for(var i,c,i,f=i=null!=(c=(i=e).flags)?c:(i.ignoreCase?"i":"")+(i.global?"g":"")+(i.multiline?"m":""),g=0;g<n.length;g++)-1==f.indexOf(n.charAt(g))&&(f+=n.charAt(g));return i==f?e:new RegExp(e.source,f)}function d(e){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source)}function a(e,n,i){var f,g,u,p;for(n=m(n,"g"),f=i.line,g=i.ch,u=e.lastLine();f<=u;f++,g=0)if(n.lastIndex=g,p=e.getLine(f),p=n.exec(p))return{from:c(f,p.index),to:c(f,p.index+p[0].length),match:p}}function o(e,n,i){var f,g,u,p,x,v,y,P,b,w;if(!d(n))return a(e,n,i);for(n=m(n,"gm"),f=1,g=i.line,u=e.lastLine();g<=u;){for(p=0;p<f&&!(u<g);p++)x=e.getLine(g++),v=null==v?x:v+"\n"+x;if(f*=2,n.lastIndex=i.ch,y=n.exec(v))return P=v.slice(0,y.index).split("\n"),b=y[0].split("\n"),w=i.line+P.length-1,P=P[P.length-1].length,{from:c(w,P),to:c(w+b.length-1,1==b.length?P+b[0].length:b[b.length-1].length),match:y}}}function L(e,n,i){var c,f,g,u;for(f=0;f<=e.length&&(n.lastIndex=f,g=n.exec(e))&&!((u=g.index+g[0].length)>e.length-i);)(!c||u>c.index+c[0].length)&&(c=g),f=g.index+1;return c}function C(e,n,i){var f,g,u,p;for(n=m(n,"g"),f=i.line,g=i.ch,u=e.firstLine();u<=f;f--,g=-1)if(p=L(p=e.getLine(f),n,g<0?0:p.length-g))return{from:c(f,p.index),to:c(f,p.index+p[0].length),match:p}}function l(e,n,i){var f,g,u,p,x,v,y,P,b,w,S;if(!d(n))return C(e,n,i);for(n=m(n,"gm"),f=1,g=e.getLine(i.line).length-i.ch,u=i.line,p=e.firstLine();p<=u;){for(x=0;x<f&&p<=u;x++)v=e.getLine(u--),y=null==y?v:v+"\n"+y;if(f*=2,P=L(y,n,g))return b=y.slice(0,P.index).split("\n"),w=P[0].split("\n"),S=u+b.length,b=b[b.length-1].length,{from:c(S,b),to:c(S+w.length-1,1==w.length?b+w[0].length:w[w.length-1].length),match:P}}}function O(e,n,i,c){var f,g,u,p;if(e.length==n.length)return i;for(f=0,g=i+Math.max(0,e.length-n.length);;){if(f==g)return f;if(u=f+g>>1,(p=c(e.slice(0,u)).length)==i)return u;i<p?g=u:f=1+u}}function h(e,f,g,u){var p,x,v,y,P,b,w,S,D,E,I,N;if(!f.length)return null;x=(p=u?n:i)(f).split(/\r|\n\r?/);t:for(v=g.line,y=g.ch,P=e.lastLine()+1-x.length;v<=P;v++,y=0)if(w=p(b=e.getLine(v).slice(y)),1==x.length){if(-1!=(S=w.indexOf(x[0])))return g=O(b,w,S,p)+y,{from:c(v,O(b,w,S,p)+y),to:c(v,O(b,w,S+x[0].length,p)+y)}}else if(D=w.length-x[0].length,w.slice(D)==x[0]){for(E=1;E<x.length-1;E++)if(p(e.getLine(v+E))!=x[E])continue t;if(N=p(I=e.getLine(v+x.length-1)),S=x[x.length-1],N.slice(0,S.length)==S)return{from:c(v,O(b,w,D,p)+y),to:c(v+x.length-1,O(I,N,S.length,p))}}}function s(e,f,g,u){var p,x,v,y,P,b,w,S,D,E,I;if(!f.length)return null;x=(p=u?n:i)(f).split(/\r|\n\r?/);t:for(v=g.line,y=g.ch,P=e.firstLine()-1+x.length;P<=v;v--,y=-1)if(b=e.getLine(v),w=p(b=-1<y?b.slice(0,y):b),1==x.length){if(-1!=(S=w.lastIndexOf(x[0])))return{from:c(v,O(b,w,S,p)),to:c(v,O(b,w,S+x[0].length,p))}}else if(D=x[x.length-1],w.slice(0,D.length)==D){for(E=1,g=v-x.length+1;E<x.length-1;E++)if(p(e.getLine(g+E))!=x[E])continue t;if((S=p(I=e.getLine(v+1-x.length))).slice(S.length-x[0].length)==x[0])return{from:c(v+1-x.length,O(I,S,I.length-x[0].length,p)),to:c(v,O(b,w,D.length,p))}}}function r(e,n,i,f){var g;this.atOccurrence=!1,this.doc=e,i=i?e.clipPos(i):c(0,0),this.pos={from:i,to:i},"object"==typeof f?g=f.caseFold:(g=f,f=null),"string"==typeof n?(null==g&&(g=!1),this.matches=function(i,c){return(i?s:h)(e,n,c,g)}):(n=m(n,"gm"),f&&!1===f.multiline?this.matches=function(i,c){return(i?C:a)(e,n,c)}:this.matches=function(i,c){return(i?l:o)(e,n,c)})}var n,i,c=e.Pos;i=String.prototype.normalize?(n=function(e){return e.normalize("NFD").toLowerCase()},function(e){return e.normalize("NFD")}):(n=function(e){return e.toLowerCase()},function(e){return e}),r.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(n){var i,f;for(i=this.matches(n,this.doc.clipPos(n?this.pos.from:this.pos.to));i&&0==e.cmpPos(i.from,i.to);)n?i.from.ch?i.from=c(i.from.line,i.from.ch-1):i=i.from.line==this.doc.firstLine()?null:this.matches(n,this.doc.clipPos(c(i.from.line-1))):i.to.ch<this.doc.getLine(i.to.line).length?i.to=c(i.to.line,i.to.ch+1):i=i.to.line==this.doc.lastLine()?null:this.matches(n,c(i.to.line+1,0));return i?(this.pos=i,this.atOccurrence=!0,this.pos.match||!0):(f=c(n?this.doc.firstLine():this.doc.lastLine()+1,0),this.pos={from:f,to:f},this.atOccurrence=!1)},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n,i){this.atOccurrence&&(n=e.splitLines(n),this.doc.replaceRange(n,this.pos.from,this.pos.to,i),this.pos.to=c(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0)))}},e.defineExtension("getSearchCursor",(function(e,n,i){return new r(this.doc,e,n,i)})),e.defineDocExtension("getSearchCursor",(function(e,n,i){return new r(this,e,n,i)})),e.defineExtension("selectMatches",(function(n,i){for(var c=[],f=this.getSearchCursor(n,this.getCursor("from"),i);f.findNext()&&!(0<e.cmpPos(f.to(),this.getCursor("to")));)c.push({anchor:f.from(),head:f.to()});c.length&&this.setSelections(c,0)}))},"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror);