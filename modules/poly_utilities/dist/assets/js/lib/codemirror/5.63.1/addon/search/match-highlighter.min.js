var t;t=function(e){"use strict";function n(e){for(var i in this.options={},o)this.options[i]=(e&&e.hasOwnProperty(i)?e:o)[i];this.overlay=this.timeout=null,this.matchesonscroll=null,this.active=!1}function r(e){var o=e.state.matchHighlighter;(o.active||e.hasFocus())&&a(e,o)}function s(e){var o=e.state.matchHighlighter;o.active||(o.active=!0,a(e,o))}function a(e,o){clearTimeout(o.timeout),o.timeout=setTimeout((function(){c(e)}),o.options.delay)}function l(e,o,i,g){var u,m,f,p=e.state.matchHighlighter;e.addOverlay(p.overlay=(u=o,m=i,f=g,{token:function(e){if(e.match(u)&&(!m||(i=m,!((o=e).start&&i.test(o.string.charAt(o.start-1))||o.pos!=o.string.length&&i.test(o.string.charAt(o.pos))))))return f;var o,i;e.next(),e.skipTo(u.charAt(0))||e.skipToEnd()}})),p.options.annotateScrollbar&&e.showMatchesOnScrollbar&&(o=i?new RegExp((/\w/.test(o.charAt(0))?"\\b":"")+o.replace(/[\\\[.+*?(){|^$]/g,"\\$&")+(/\w/.test(o.charAt(o.length-1))?"\\b":"")):o,p.matchesonscroll=e.showMatchesOnScrollbar(o,!1,{className:"CodeMirror-selection-highlight-scrollbar"}))}function h(e){var o=e.state.matchHighlighter;o.overlay&&(e.removeOverlay(o.overlay),o.overlay=null,o.matchesonscroll&&(o.matchesonscroll.clear(),o.matchesonscroll=null))}function c(e){e.operation((function(){var o,i,g,u,m,f,p,v=e.state.matchHighlighter;if(h(e),e.somethingSelected()||!v.options.showToken)o=e.getCursor("from"),i=e.getCursor("to"),o.line==i.line&&(v.options.wordsOnly&&!function(e,o,i){if(null===e.getRange(o,i).match(/^\w+$/))return!1;if(0<o.ch){var g={line:o.line,ch:o.ch-1};if(null===e.getRange(g,o).match(/\W/))return!1}return!(i.ch<e.getLine(o.line).length&&(g={line:i.line,ch:i.ch+1},null===e.getRange(i,g).match(/\W/)))}(e,o,i)||(u=e.getRange(o,i),(u=v.options.trim?u.replace(/^\s+|\s+$/g,""):u).length>=v.options.minChars&&l(e,u,!1,v.options.style)));else{for(g=!0===v.options.showToken?/[\w$]/:v.options.showToken,u=e.getCursor(),m=e.getLine(u.line),p=f=u.ch;f&&g.test(m.charAt(f-1));)--f;for(;p<m.length&&g.test(m.charAt(p));)++p;f<p&&l(e,m.slice(f,p),g,v.options.style)}}))}var o={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};e.defineOption("highlightSelectionMatches",!1,(function(o,i,g){g&&g!=e.Init&&(h(o),clearTimeout(o.state.matchHighlighter.timeout),o.state.matchHighlighter=null,o.off("cursorActivity",r),o.off("focus",s)),i&&(i=o.state.matchHighlighter=new n(i),o.hasFocus()?(i.active=!0,c(o)):o.on("focus",s),o.on("cursorActivity",r))}))},"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],t):t(CodeMirror);